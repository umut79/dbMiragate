<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Veritabanı Kopyalama</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="p-4">

<h3>Veritabanı Kopyalama</h3>

<form id="connForm" class="mb-4">
  <input name="src_host" placeholder="Kaynak Host" class="form-control mb-2">
  <input name="src_db" placeholder="Kaynak DB" class="form-control mb-2">
  <input name="src_user" placeholder="Kaynak User" class="form-control mb-2">
  <input name="src_pass" placeholder="Kaynak Şifre" type="password" class="form-control mb-2">

  <input name="dst_host" placeholder="Hedef Host" class="form-control mb-2">
  <input name="dst_db" placeholder="Hedef DB" class="form-control mb-2">
  <input name="dst_user" placeholder="Hedef User" class="form-control mb-2">
  <input name="dst_pass" placeholder="Hedef Şifre" type="password" class="form-control mb-2">

  <button class="btn btn-primary">Bağlan ve Başlat</button>
</form>

<div id="progressArea" class="d-none">
  <div class="progress mb-2">
    <div id="progressBar" class="progress-bar progress-bar-striped" role="progressbar" style="width: 0%">0%</div>
  </div>
  <p id="progressText"></p>
</div>

<script>
const form = document.getElementById("connForm");
const progressArea = document.getElementById("progressArea");
const progressBar = document.getElementById("progressBar");
const progressText = document.getElementById("progressText");

form.addEventListener("submit", async e => {
    e.preventDefault();
    const data = new FormData(form);
    await fetch("vt_session.php", { method: "POST", body: data });
    // form.reset();
    progressArea.classList.remove("d-none");
    runStep(0);
});

async function runStep(step) {
    const res = await fetch("vt_copy.php?step=" + step);
    const json = await res.json();

    if (json.status === "ok") {
        let percent = Math.round((json.current / json.total) * 100);
        progressBar.style.width = percent + "%";
        progressBar.textContent = percent + "%";
        progressText.textContent = "Kopyalanıyor: " + json.table + " (" + json.current + "/" + json.total + ")";
        runStep(step + 1);
    } else if (json.status === "done") {
        progressBar.style.width = "100%";
        progressBar.textContent = "100%";
        progressText.textContent = "Kopyalama tamamlandı ✅";
    } else {
        progressText.textContent = "Hata: " + json.message;
    }
}
</script>
</body>
</html>
